<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <!-- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø²ÙˆÙ… Ø®ÙˆØ¯Ú©Ø§Ø± Ú©ÛŒØ¨ÙˆØ±Ø¯ Ø¯Ø± Ú¯ÙˆØ´ÛŒ Ú©Ù‡ Ø¨Ø§Ø¹Ø« Ø¨Ù‡Ù… Ø±ÛŒØ®ØªÚ¯ÛŒ Ù‚Ø§Ù„Ø¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø®Ø·Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§Ø² Ø¬Ù…Ø¹Ù‡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0ea5e9;
            --secondary: #8b5cf6;
            --dark-glass: rgba(15, 23, 42, 0.7);
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0;
            overflow-x: hidden;
            background-color: #020617;
            color: #e2e8f0;
        }

        /* ----- Ø¨ÙˆÙ… Ø´Ø¨Ú©Ù‡ Ø¹ØµØ¨ÛŒ Ø¯Ø± Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ ----- */
        #particle-canvas {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -2; pointer-events: none;
        }

        /* ----- Ù‡Ø³ØªÙ‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ----- */
        #ai-core {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            /* Ø§ØµÙ„Ø§Ø­ Ø³Ø§ÛŒØ² Ø¨Ø±Ø§ÛŒ Ú¯ÙˆØ´ÛŒ */
            width: 90vw; max-width: 400px; height: 90vw; max-height: 400px; 
            z-index: -1; pointer-events: none; opacity: 0.15;
            transition: transform 0.1s ease-out; filter: drop-shadow(0 0 30px var(--primary));
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float { 0% { top: 50%; } 50% { top: 48%; } 100% { top: 50%; } }

        /* ----- Ø´ÛŒØ´Ù‡ ØªØ§Ø±ÛŒÚ© ----- */
        .glass-panel {
            background: var(--dark-glass); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
        }
        .glass-panel::before {
            content: ""; position: absolute; top: var(--mouse-y, 0); left: var(--mouse-x, 0);
            transform: translate(-50%, -50%); 
            /* Ø§ØµÙ„Ø§Ø­ Ù‡Ø§Ù„Ù‡ Ù†ÙˆØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨ÛŒØ±ÙˆÙ† Ø²Ø¯Ú¯ÛŒ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            width: 100vw; height: 100vw; max-width: 500px; max-height: 500px;
            background: radial-gradient(circle, rgba(14, 165, 233, 0.1) 0%, transparent 70%);
            pointer-events: none; z-index: 0; transition: opacity 0.3s;
        }
        .glass-panel > * { position: relative; z-index: 1; }

        /* ----- ÙˆØ±ÙˆØ¯ÛŒ Ù‡Ø§ÛŒ Ù…ØªÙ†ÛŒ ----- */
        .neon-input {
            background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); color: #f8fafc; transition: all 0.4s;
        }
        .neon-input:focus {
            background: rgba(0, 0, 0, 0.5); border-color: var(--primary);
            box-shadow: 0 0 20px rgba(14, 165, 233, 0.2), inset 0 0 10px rgba(14, 165, 233, 0.1); transform: translateY(-2px);
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); box-shadow: 0 0 10px var(--primary); }

        /* ----- Ø¯Ú©Ù…Ù‡ Ù‡Ø§ Ùˆ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù‡Ø§ ----- */
        .cyber-btn {
            position: relative; background: linear-gradient(135deg, var(--primary), var(--secondary));
            overflow: hidden; z-index: 1; transition: all 0.3s ease;
            touch-action: manipulation; /* Ø±ÙØ¹ Ù…Ø´Ú©Ù„ Ú©Ù„ÛŒÚ© Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        }
        .cyber-btn::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s ease; z-index: -1;
        }
        .cyber-btn:hover::before { left: 100%; }
        .cyber-btn:hover { box-shadow: 0 0 25px rgba(139, 92, 246, 0.5); transform: scale(1.02); }

        .radar-loader {
            width: 80px; height: 80px; border-radius: 50%; border: 2px solid rgba(14, 165, 233, 0.2);
            position: relative; overflow: hidden; box-shadow: 0 0 20px rgba(14, 165, 233, 0.3);
        }
        .radar-loader::before {
            content: ""; position: absolute; top: 50%; left: 50%; width: 50%; height: 50%;
            background: linear-gradient(45deg, transparent, rgba(14, 165, 233, 0.8));
            transform-origin: 0 0; animation: radar 2s linear infinite;
        }
        @keyframes radar { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .output-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 1rem; padding: 1.5rem; margin-bottom: 1rem; position: relative; overflow: hidden;
            word-wrap: break-word; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ù‡Ù… Ø±ÛŒØ®ØªÚ¯ÛŒ Ù…ØªÙ† Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø¯Ø± Ú¯ÙˆØ´ÛŒ */
        }
        .output-card::before { content: ""; position: absolute; top: 0; right: 0; width: 4px; height: 100%; }
        .output-khutbah1::before { background: #3b82f6; }
        .output-khutbah2::before { background: #10b981; }
        .output-overall::before { background: #f59e0b; }

        .cursor-blink::after { content: '|'; animation: blink 1s step-end infinite; color: var(--primary); }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body class="antialiased text-gray-200">

    <canvas id="particle-canvas"></canvas>

    <svg id="ai-core" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <circle cx="50" cy="50" r="45" fill="none" stroke="#0ea5e9" stroke-width="0.5" stroke-dasharray="2 4" />
        <circle cx="50" cy="50" r="35" fill="none" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="10 5">
            <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="20s" repeatCount="indefinite"/>
        </circle>
        <circle cx="50" cy="50" r="20" fill="none" stroke="#0ea5e9" stroke-width="2" />
        <circle id="pupil" cx="50" cy="50" r="8" fill="#0ea5e9" opacity="0.8">
            <animate attributeName="r" values="8;10;8" dur="3s" repeatCount="indefinite" />
        </circle>
        <path d="M50 20 L50 10 M50 80 L50 90 M20 50 L10 50 M80 50 L90 50" stroke="#8b5cf6" stroke-width="2" opacity="0.5"/>
    </svg>

    <div class="container mx-auto max-w-6xl p-4 md:p-8 min-h-screen flex flex-col items-center justify-center">
        
        <header class="text-center mb-10 relative z-10 w-full mt-8">
            <div class="inline-block border border-sky-500/30 bg-sky-500/10 text-sky-400 px-4 py-1 rounded-full text-xs md:text-sm font-bold tracking-widest mb-4 shadow-[0_0_10px_rgba(14,165,233,0.2)]">
                AI SERMON ANALYZER
            </div>
            <!-- Ù…ØªÙ† ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡ -->
            <h1 class="text-3xl md:text-5xl lg:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-purple-500 drop-shadow-lg mb-4">
                Ø®Ù„Ø§ØµÙ‡ Ø³Ø§Ø²ÛŒ Ø®Ø·Ø¨Ù‡ Ù‡Ø§
            </h1>
            <p class="text-gray-400 text-base md:text-xl font-light">
                Ù†Ø³Ø®Ù‡ Ø§Ù…Ù† Ùˆ Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª IP (Ù…ØªØµÙ„ Ø¨Ù‡ Ø³Ø±ÙˆØ± ÙˆØ§Ø³Ø·Ù‡)
            </p>
        </header>

        <main id="mainCard" class="glass-panel w-full p-5 md:p-10 rounded-3xl transition-all duration-500 relative">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-10">
                <div class="group relative">
                    <label class="block mb-3 font-bold text-sky-300 text-base md:text-lg flex items-center">
                        <svg class="w-5 h-5 ml-2 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                        Ø®Ø·Ø¨Ù‡ Ø§ÙˆÙ„ (Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø°Ù‡Ø¨ÛŒ)
                    </label>
                    <!-- Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø§Ú©Ø³ Ø¨Ø±Ø§ÛŒ Ú¯ÙˆØ´ÛŒ Ú©ÙˆÚ†Ú©ØªØ± Ø´Ø¯Ù‡ ØªØ§ Ø¯Ú©Ù…Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ù†Ø±ÙˆØ¯ -->
                    <textarea id="khutbah1" class="neon-input w-full p-4 md:p-5 rounded-2xl outline-none text-gray-200 leading-relaxed resize-none text-base h-40 md:h-60" placeholder="Ù…ØªÙ† Ø®Ø·Ø¨Ù‡ Ø§ÙˆÙ„ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
                </div>
                <div class="group relative">
                    <label class="block mb-3 font-bold text-purple-300 text-base md:text-lg flex items-center">
                        <svg class="w-5 h-5 ml-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Ø®Ø·Ø¨Ù‡ Ø¯ÙˆÙ… (Ù…Ø­ØªÙˆØ§ÛŒ Ø³ÛŒØ§Ø³ÛŒ/Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ)
                    </label>
                    <textarea id="khutbah2" class="neon-input w-full p-4 md:p-5 rounded-2xl outline-none text-gray-200 leading-relaxed resize-none text-base h-40 md:h-60" placeholder="Ù…ØªÙ† Ø®Ø·Ø¨Ù‡ Ø¯ÙˆÙ… Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
                </div>
            </div>

            <div class="text-center mb-6 relative z-10 flex justify-center">
                <button id="generateBtn" class="cyber-btn flex items-center justify-center text-white font-black text-lg md:text-xl py-4 px-8 md:px-12 rounded-full cursor-pointer shadow-lg w-full md:w-auto">
                    <svg class="w-6 h-6 md:w-7 md:h-7 ml-3 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    Ø¢ØºØ§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                </button>
            </div>
            
            <div id="loading" class="hidden flex-col items-center justify-center my-10 transition-all duration-500 opacity-0">
                <div class="radar-loader"></div>
                <p id="loadingText" class="mt-6 text-sky-400 font-bold text-base md:text-lg tracking-widest text-center">Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± ÙˆØ§Ø³Ø·Ù‡ Vercel...</p>
            </div>

            <div id="resultContainer" class="hidden mt-8 transform transition-all duration-700 opacity-0 translate-y-10">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 pb-4 border-b border-gray-700/50 gap-4">
                    <h2 class="text-2xl md:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-600 flex items-center">
                        <svg class="w-7 h-7 md:w-8 md:h-8 text-green-500 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯
                    </h2>
                    
                    <button id="copyBtn" class="w-full md:w-auto group flex items-center justify-center bg-gray-800/80 hover:bg-sky-600 border border-gray-600 hover:border-sky-500 text-gray-300 hover:text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 shadow-lg">
                        <svg id="copyIcon" class="w-5 h-5 ml-2 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                        <span id="copyText">Ú©Ù¾ÛŒ Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯</span>
                    </button>
                </div>
                
                <div id="output" class="text-base md:text-lg leading-loose text-gray-300 font-medium"></div>
            </div>

             <div id="error" class="hidden mt-6 bg-red-900/30 border border-red-500/50 text-red-400 p-5 rounded-xl shadow-[0_0_15px_rgba(239,68,68,0.2)] backdrop-blur-sm" role="alert">
                <div class="flex items-center">
                    <svg class="w-6 h-6 mr-2 ml-2 text-red-500 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    <strong class="font-bold text-lg">Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´!</strong>
                </div>
                <span class="block mt-2 font-medium text-red-200" id="errorMessage"></span>
            </div>
        </main>
    </div>

    <!-- Ù…ØªØºÛŒØ± Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ù…ØªÙ† Ø®Ø§Ù… -->
    <textarea id="copyHelper" class="hidden absolute -left-full -top-full"></textarea>

    <script>
        // 1. Particle Canvas Logic (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles;
        let mouse = { x: null, y: null, radius: 150 };

        function initCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            particles = [];
            let particleCount = (width * height) / 12000;
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * width, y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.5, vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 2 + 1
                });
            }
        }

        function drawParticles() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = 'rgba(14, 165, 233, 0.5)';
            particles.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > width) p.vx *= -1;
                if (p.y < 0 || p.y > height) p.vy *= -1;

                if(mouse.x != null) {
                    let dx = mouse.x - p.x; let dy = mouse.y - p.y;
                    let distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < mouse.radius) { p.x += dx * 0.01; p.y += dy * 0.01; }
                }
                ctx.beginPath(); ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2); ctx.fill();

                particles.forEach(p2 => {
                    let dx = p.x - p2.x; let dy = p.y - p2.y;
                    let dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 100) {
                        ctx.beginPath(); ctx.strokeStyle = `rgba(139, 92, 246, ${1 - dist/100})`;
                        ctx.lineWidth = 0.5; ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
                    }
                });
            });
            requestAnimationFrame(drawParticles);
        }
        window.addEventListener('resize', initCanvas); initCanvas(); drawParticles();

        // 2. Interactive AI Core & Parallax
        const aiCore = document.getElementById('ai-core');
        const mainCard = document.getElementById('mainCard');
        const aiPupil = document.getElementById('pupil');

        window.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX; mouse.y = e.clientY;
            const rect = mainCard.getBoundingClientRect();
            mainCard.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`);
            mainCard.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`);

            const cx = window.innerWidth / 2; const cy = window.innerHeight / 2;
            const moveX = (e.clientX - cx) * 0.05; const moveY = (e.clientY - cy) * 0.05;
            aiCore.style.transform = `translate(calc(-50% + ${moveX}px), calc(-50% + ${moveY}px))`;
            
            const pupilX = 50 + (e.clientX - cx) * 0.01; const pupilY = 50 + (e.clientY - cy) * 0.01;
            aiPupil.setAttribute('cx', pupilX); aiPupil.setAttribute('cy', pupilY);
        });
        window.addEventListener('mouseout', () => { mouse.x = null; mouse.y = null; });

        // 3. API Logic (VERCEL PROXY EDITION)
        const generateBtn = document.getElementById('generateBtn');
        const khutbah1Input = document.getElementById('khutbah1');
        const khutbah2Input = document.getElementById('khutbah2');
        const loadingDiv = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const resultContainer = document.getElementById('resultContainer');
        const outputDiv = document.getElementById('output');
        const copyBtn = document.getElementById('copyBtn');
        const copyHelper = document.getElementById('copyHelper');
        const errorDiv = document.getElementById('error');
        const errorMessageSpan = document.getElementById('errorMessage');

        const loadingMessages = [
            "Ø¯Ø± Ø­Ø§Ù„ Ø®ÙˆØ§Ù†Ø¯Ù† Ù…ØªÙˆÙ†...", "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Vercel...", "ØªØ¬Ø²ÛŒÙ‡ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ù†Ø§ÛŒÛŒ...",
            "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ú©Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ...", "Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø±ÙˆØ¬ÛŒ..."
        ];

        let loadingInterval;
        generateBtn.addEventListener('click', handleGeneration);
        copyBtn.addEventListener('click', copyOutputToClipboard);

        async function handleGeneration() {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ú©ÛŒØ¨ÙˆØ±Ø¯ Ú¯ÙˆØ´ÛŒ Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú¯ÛŒØ± Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡
            khutbah1Input.blur();
            khutbah2Input.blur();

            resultContainer.classList.remove('opacity-100', 'translate-y-0');
            resultContainer.classList.add('opacity-0', 'translate-y-10');
            setTimeout(() => resultContainer.classList.add('hidden'), 500);
            errorDiv.classList.add('hidden');
            
            const khutbah1Text = khutbah1Input.value.trim();
            const khutbah2Text = khutbah2Input.value.trim();

            if (!khutbah1Text || !khutbah2Text) {
                showError("Ø®Ø·Ø§: Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù‚Øµ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ù‡Ø± Ø¯Ùˆ ÙÛŒÙ„Ø¯ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯."); return;
            }

            generateBtn.disabled = true;
            generateBtn.innerHTML = `<span class="modern-loader"></span> Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...`;
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed', 'scale-95');
            
            loadingDiv.classList.remove('hidden');
            setTimeout(() => loadingDiv.classList.remove('opacity-0'), 50);
            
            let msgIndex = 0; loadingText.innerText = loadingMessages[0];
            loadingInterval = setInterval(() => {
                msgIndex = (msgIndex + 1) % loadingMessages.length;
                loadingText.innerText = loadingMessages[msgIndex];
            }, 1500);

            const prompt = `
                Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù…ØªØ®ØµØµ Ø¯Ø± Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ ØªØ­Ù„ÛŒÙ„ Ù…Ø­ØªÙˆØ§ÛŒ Ø®Ø·Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§Ø² Ø¬Ù…Ø¹Ù‡ Ù‡Ø³ØªÛŒØ¯.
                Ù…ØªÙ† Ø®Ø·Ø¨Ù‡ Ø§ÙˆÙ„: ${khutbah1Text}
                Ù…ØªÙ† Ø®Ø·Ø¨Ù‡ Ø¯ÙˆÙ…: ${khutbah2Text}
                Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„â€ŒÙ‡Ø§:
                1. impactfulTitle: ØªÛŒØªØ± Ú©Ù„ÛŒØŒ ØªØ§Ø«ÛŒØ±Ú¯Ø°Ø§Ø± Ùˆ Ø¬Ø°Ø§Ø¨ (ÛŒÚ© Ø¬Ù…Ù„Ù‡).
                2. khutbah1.title: ØªÛŒØªØ± Ø®Ø·Ø¨Ù‡ Ø§ÙˆÙ„ (Û² ØªØ§ Û´ Ú©Ù„Ù…Ù‡).
                3. khutbah1.summary: Ø®Ù„Ø§ØµÙ‡ Ø®Ø·Ø¨Ù‡ Ø§ÙˆÙ„ (Ù…Ø°Ù‡Ø¨ÛŒ/Ø§Ø®Ù„Ø§Ù‚ÛŒ) Ø¨ÛŒÙ† Û³ ØªØ§ Ûµ Ø¨Ø®Ø´ (heading Ùˆ explanation).
                4. khutbah2.title: ØªÛŒØªØ± Ø®Ø·Ø¨Ù‡ Ø¯ÙˆÙ… (Û² ØªØ§ Û´ Ú©Ù„Ù…Ù‡).
                5. khutbah2.summary: Ø®Ù„Ø§ØµÙ‡ Ø®Ø·Ø¨Ù‡ Ø¯ÙˆÙ… (Ø³ÛŒØ§Ø³ÛŒ/Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ) Ø¨ÛŒÙ† Û³ ØªØ§ Ûµ Ø¨Ø®Ø´.
                6. overallSummary.title: ØªÛŒØªØ± Ø®Ù„Ø§ØµÙ‡ Ù†Ù‡Ø§ÛŒÛŒ.
                7. overallSummary.text: Ø®Ù„Ø§ØµÙ‡ Ú©Ù„ÛŒ (Ø­Ø¯ÙˆØ¯ Û´ Ø®Ø·).
                ÙÙ‚Ø· JSON Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†.
            `;

            const schema = {
                type: "OBJECT", properties: {
                    "impactfulTitle": { "type": "STRING" },
                    "khutbah1": { "type": "OBJECT", "properties": { "title": { "type": "STRING" }, "summary": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "heading": { "type": "STRING" }, "explanation": { "type": "STRING" } }, "required": ["heading", "explanation"] } } }, "required": ["title", "summary"] },
                    "khutbah2": { "type": "OBJECT", "properties": { "title": { "type": "STRING" }, "summary": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "heading": { "type": "STRING" }, "explanation": { "type": "STRING" } }, "required": ["heading", "explanation"] } } }, "required": ["title", "summary"] },
                    "overallSummary": { "type": "OBJECT", "properties": { "title": { "type": "STRING" }, "text": { "type": "STRING" } }, "required": ["title", "text"] }
                }, "required": ["impactfulTitle", "khutbah1", "khutbah2", "overallSummary"]
            };
            
            try {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema: schema } };
                
                // --------- Ù…Ù‡Ù…: Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± ÙˆØ§Ø³Ø· Vercel ---------
                const endpoint = '/api/proxy'; 
                const response = await fetch(endpoint, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(payload) 
                });

                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(errorBody.error || response.statusText);
                }
                
                const result = await response.json();
                
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const jsonText = result.candidates[0].content.parts[0].text;
                    const data = JSON.parse(jsonText);
                    buildAndRevealOutput(data);
                } else {
                    throw new Error("Ù¾Ø§Ø³Ø® Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø³Ø§Ø®ØªØ§Ø± Ù…Ø¹ØªØ¨Ø±ÛŒ Ù†Ø¯Ø§Ø±Ø¯.");
                }

            } catch (err) {
                showError(`Ù†Ù‚Øµ ÙÙ†ÛŒ: ${err.message} (Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ø±ÙˆÛŒ Vercel Ø¯ÛŒÙ¾Ù„ÙˆÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª)`);
            } finally {
                clearInterval(loadingInterval);
                loadingDiv.classList.add('opacity-0');
                setTimeout(() => loadingDiv.classList.add('hidden'), 500);
                
                generateBtn.disabled = false;
                generateBtn.innerHTML = `<svg class="w-6 h-6 md:w-7 md:h-7 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Ø¢ØºØ§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø¬Ø¯Ø¯`;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'scale-95');
            }
        }

        // 4. Output Formatting & Typewriter Effect
        function buildAndRevealOutput(data) {
            const intro = "Ø¨Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø¹Ø§ÙˆÙ†Øª Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ùˆ Ø±Ø³Ø§Ù†Ù‡ Ø¯ÙØªØ± Ø§Ù…Ø§Ù… Ø¬Ù…Ø¹Ù‡ Ø¯Ù‡Ø³ØªØ§Ù† Ù…ÛŒØ§Ù†Ú©Ø§Ù„Ù‡ (Ø²Ø§ØºÙ…Ø±Ø²)ØŒ Ø­Ø¬Øª Ø§Ù„Ø§Ø³Ù„Ø§Ù… ÙˆØ§Ù„Ù…Ø³Ù„Ù…ÛŒÙ† Ø­Ø§Ø¬ Ø­Ø³ÛŒÙ† Ø§Ù†Ø²Ø§Ø¦ÛŒ Ø¯Ø± Ø®Ø·Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Ø§Ø² Ù†Ù…Ø§Ø² Ø¬Ù…Ø¹Ù‡ØŒ Ø¶Ù…Ù† Ø³ÙØ§Ø±Ø´ Ø¨Ù‡ ØªÙ‚ÙˆØ§ Ø§Ø¸Ù‡Ø§Ø± Ú©Ø±Ø¯:";
            
            // Raw Text for Copy
            let rawText = `Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÛŒÙ…\n\nÂ«${data.impactfulTitle}Â»\n\n${intro}\n\n`;
            rawText += `ğŸ”¸ Ø®Ø·Ø¨Ù‡ Ø§ÙˆÙ„: ${data.khutbah1.title}\n`;
            data.khutbah1.summary.forEach((i, idx) => rawText += `${idx + 1}. ${i.heading}\n   ${i.explanation}\n\n`);
            rawText += `---\nğŸ”¹ Ø®Ø·Ø¨Ù‡ Ø¯ÙˆÙ…: ${data.khutbah2.title}\n`;
            data.khutbah2.summary.forEach((i, idx) => rawText += `${idx + 1}. ${i.heading}\n   ${i.explanation}\n\n`);
            rawText += `---\nğŸ“Œ ${data.overallSummary.title}\n${data.overallSummary.text}`;
            copyHelper.value = rawText.trim();

            // Rich HTML
            let htmlContent = `
                <div class="text-center mb-8">
                    <span class="text-gray-400 text-sm tracking-widest">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÛŒÙ…</span>
                    <h3 class="text-xl md:text-3xl font-black text-sky-300 mt-4 mb-4 leading-normal px-2 md:px-4">Â«${data.impactfulTitle}Â»</h3>
                    <p class="text-gray-300 text-sm md:text-lg max-w-3xl mx-auto border-b border-gray-700/50 pb-6">${intro}</p>
                </div>
                <div class="output-card output-khutbah1">
                    <h4 class="text-lg md:text-xl font-bold text-blue-400 mb-4 flex items-center">
                        <span class="bg-blue-500/20 p-2 rounded-lg ml-3"><svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path></svg></span>
                        Ø®Ø·Ø¨Ù‡ Ø§ÙˆÙ„: ${data.khutbah1.title}
                    </h4>
                    <div class="space-y-4 pr-2">
                        ${data.khutbah1.summary.map(i => `<div class="border-r-2 border-blue-500/30 pr-4"><strong class="text-blue-300 block mb-1 text-base md:text-lg">${i.heading}</strong><span class="text-gray-400 text-sm md:text-base">${i.explanation}</span></div>`).join('')}
                    </div>
                </div>
                <div class="output-card output-khutbah2">
                    <h4 class="text-lg md:text-xl font-bold text-emerald-400 mb-4 flex items-center">
                        <span class="bg-emerald-500/20 p-2 rounded-lg ml-3"><svg class="w-5 h-5 text-emerald-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"></path></svg></span>
                        Ø®Ø·Ø¨Ù‡ Ø¯ÙˆÙ…: ${data.khutbah2.title}
                    </h4>
                    <div class="space-y-4 pr-2">
                        ${data.khutbah2.summary.map(i => `<div class="border-r-2 border-emerald-500/30 pr-4"><strong class="text-emerald-300 block mb-1 text-base md:text-lg">${i.heading}</strong><span class="text-gray-400 text-sm md:text-base">${i.explanation}</span></div>`).join('')}
                    </div>
                </div>
                <div class="output-card output-overall">
                    <h4 class="text-lg md:text-xl font-bold text-amber-400 mb-4 flex items-center">
                        <span class="bg-amber-500/20 p-2 rounded-lg ml-3"><svg class="w-5 h-5 text-amber-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></span>
                        ${data.overallSummary.title}
                    </h4>
                    <p class="text-gray-300 pr-2 leading-relaxed text-sm md:text-base">${data.overallSummary.text}</p>
                </div>
            `;

            outputDiv.innerHTML = "";
            resultContainer.classList.remove('hidden');
            setTimeout(() => {
                resultContainer.classList.remove('opacity-0', 'translate-y-10');
                resultContainer.classList.add('opacity-100', 'translate-y-0');
                outputDiv.classList.add('cursor-blink');
                outputDiv.innerHTML = htmlContent; outputDiv.style.opacity = 0;
                let fadeEffect = setInterval(function () {
                    if (outputDiv.style.opacity < 1) outputDiv.style.opacity = parseFloat(outputDiv.style.opacity) + 0.1;
                    else { clearInterval(fadeEffect); outputDiv.classList.remove('cursor-blink'); }
                }, 50);
                
                // Ø§Ø³Ú©Ø±ÙˆÙ„ Ù†Ø±Ù… Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ø¯Ø± Ú¯ÙˆØ´ÛŒ
                const y = resultContainer.getBoundingClientRect().top + window.scrollY - 20;
                window.scrollTo({top: y, behavior: 'smooth'});
            }, 100);
        }

        function showError(message) { errorMessageSpan.textContent = message; errorDiv.classList.remove('hidden'); }
        
        // Ø³ÛŒØ³ØªÙ… Ú©Ù¾ÛŒ Ø¬Ø¯ÛŒØ¯ Ùˆ Ù…Ø¯Ø±Ù† Ú©Ù‡ Ø¯Ø± Ú¯ÙˆØ´ÛŒ Ø¨Ø§Ú¯ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        async function copyOutputToClipboard() {
            const btn = document.getElementById('copyBtn'); 
            const icon = document.getElementById('copyIcon'); 
            const text = document.getElementById('copyText');
            const textToCopy = copyHelper.value;

            try {
                await navigator.clipboard.writeText(textToCopy);
                
                btn.classList.add('bg-green-600', 'border-green-500', 'text-white'); 
                btn.classList.remove('bg-gray-800/80', 'text-gray-300');
                text.innerText = 'Ú©Ù¾ÛŒ Ø´Ø¯!'; 
                icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />`;
                
                setTimeout(() => {
                    btn.classList.remove('bg-green-600', 'border-green-500', 'text-white'); 
                    btn.classList.add('bg-gray-800/80', 'text-gray-300');
                    text.innerText = 'Ú©Ù¾ÛŒ Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯'; 
                    icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />`;
                }, 3000);
            } catch (err) { 
                alert('Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ´ Ø¢Ù…Ø¯ ÛŒØ§ Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.'); 
            }
        }
    </script>
</body>
</html>
